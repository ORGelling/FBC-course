endif



* Flexc++ will be called on any scanner specification files.
  executable programs.
## Influencing the Makefile:

    FLEXCXX_SCANNERSPEC_EXTENSION (defaults to: $(FLEXCXX_SCANNERSPEC_EXTENSION))
    PCH=no      prevents precompiled headers from being built,
## Creating files from templates:
    mkdir parser
file extension with non-program sources.

ifneq ($(CURDIR),$(firstword $(CURDIR)))
ALL_FILES := $(patsubst ./%,%,$(call rwildcard,.,*))
CXXFLAGS ?= -std=c++26 -Wall -Werror

CXX_OBJECT_EXTENSION ?= $(CXX_SOURCE_EXTENSION).o
VERBOSE ?= false
# turned off. Try: make DEP=no
SHAREDLIB_EXTENSION = so

undefine DETECTED_MAKEVERSION
)

# QUIET is a '@', unless VERBOSE is true.
# On e.g. foo/bar/baz returns foo/bar/ foo/
# Lists dirs recursively, deepest first, with no duplicates.
CXX_OBJECTS := $(CXX_SOURCES:%.$(CXX_SOURCE_EXTENSION)=%.$(CXX_OBJECT_EXTENSION))
CXX_PROG_SOURCES := $(if $(CXX_SOURCES),$(shell grep -El '$(MAIN_REGEX)' $(CXX_SOURCES)))

FLEXCXX_DEPS := $(call deps_of,$(FLEXCXX_SCANNERSPECS))
ALL_DEPS = $(CXX_SOURCE_DEPS) $(CXX_PCH_DEPS) $(FLEXCXX_DEPS) $(BISONCXX_DEPS)
define RUN-CPPCOMPILE
%.o: %.C



GENERATED_EXTENSIONS = $(CXX_OBJECT_EXTENSION) $(CONVLIB_EXTENSION) $(SHAREDLIB_EXTENSION) $(CXX_PCH_EXTENSION) $(DEP_EXTENSION)
UNKNOWN_GENERATED_FILES = $(filter-out $(KNOWN_GENERATED_FILES),$(EVER_GENERATED_FILES))
# A rule says two things:
	$(QUIET) $(AR) rcs $@ $^

# 4. it won't work with parallel Make.
# If the source is newer than its object, we compile it.

	@echo ok
.INTERMEDIATE: $(CXX_OBJECTS) $(CXX_PRECOMPILED_HEADERS)
# If asked explicitly, we can make a metadata.txt... maybe.

	@echo "The metadata.txt tells us what set this is, who worked on the exercises, and who should rate them."
# If asked explicitly, we can make an initial order.txt.
	@cat $@
	@echo "You may therefore want to make clean before making order.txt."

            $(info However, there is one in the parent directory.)
            $(info 'make metadata.txt' or 'make ../metadata.txt' and edit the example.)
            $(info A metadata.txt was found: $(METADATAS))
        # Multiple metadata.txts found.
        endif
    ifneq ($(DIRECT_SUBDIRS),$(NUMERIC_DIRECT_SUBDIRS))
    endif
	echo "To be done: create $(@)"

	@echo "Files mentioned in order.txt files exist."

# So we use this trick: 'make foo.cc:program' will create a program 'foo.cc'.
%\:program:

# To detect (internal) headers that already exist in the dir.
using namespace std;\n

enum ExitCode
int handle_exceptions(std::exception_ptr excp);
    }
        return ExitCode::SUCCESS;
    }

//%%filenames = "basename"
//%%namespace = "identifer"
//%%x miniscanners
# Parser specification (grammar) template:

// %%target-directory: defining the directory where files must be written
%%%%

endef
endef
# Templatable goals can be made from a template, and are by definition nonexistent.
    %.$(FLEXCXX_SCANNERSPEC_EXTENSION): TEMPLATE = $(FLEXCXX_SCANNERSPEC_TEMPLATE)
endif
    # Prevent dependency generation if MAKECMDGOALS is non-empty and consists
    ifneq (,$(NEED_DEP_INCLUDES))
    undefine GOALS_THAT_NEED_DEPS
    # Meaning:
	$(ECHO_ACTION)
    # as the specification file they were generated from.

	$(QUIET) mkdir -p $(dir $@)

	$(QUIET) rm -f $(ALL_DEPS)
# result it may want to make foo/../bar.ih.gch,
	@echo "    [ Substituting \"$$<\" <- \"$$@\": same file by straightened path. ]"

    # Each internal header shall become a precompiled header.
    # (Leaving the internal header in is simpler and doesn't hurt.)
	grep -E '^[[:space:]]*#include[[:space:]]"' $(CXX_SOURCES) $(CXX_INTERNAL_HEADERS)|awk '{ sub(/:[[:space:]]*#include/, "", $$0); gsub(/^[[:space:]]+|[[:space:]]+$$/, "", $$1); print $$2, " -> \"" $$1 "\" [label = inc] " }' > $@
