# If the OS is FreeBSD, use gmake instead of make
It requires very little extra configuration.
Put Makefile and sources in one directory and there issue the command:
## Default behavior:
* C++ source files and internal headers will be preprocessed in order to
* If included anywhere, C++ internal header files will be precompiled.
remade. On one hand, this consumes time. On the other hand it saves time by
(defaults to: $(BISONCXX)) These can be set in the usual ways:
    CXX_HEADER_EXTENSION (defaults to: $(CXX_HEADER_EXTENSION))
Some variables change the behaviour more extensively:
source file includes which internal header, so it will not create or


source files will find the internal header in turn.
This requires a metadata.txt in the set dir and order.txt files in the

# We recognize files by their extensions, because file magic doesn't always

CXX_HEADER_EXTENSION ?= $(call first_extension_found, hh hpp H h)
# Try: 'make VERBOSE=1'
# We analyze and heed generated dependencies by default. But they can be
CONVLIB_FILE = lib$(CONVLIB).$(CONVLIB_EXTENSION)
FLEXCXX ?= flexc++
ifneq ($(firstword $(filter GNU,$(DETECTED_MAKEVERSION))),GNU)
   $(if $(filter $(1),f false False FALSE no  No  NO  NOO!  off Off OFF zero Zero ZERO 0),false,),\
#SP is for alignments


rdirs=$(call reverse,$(sort $(foreach dir,$1,$(call rdir,$(dir)))))

CXX_PROG_OBJECTS := $(patsubst %.$(CXX_SOURCE_EXTENSION),%.$(CXX_OBJECT_EXTENSION),$(CXX_PROG_SOURCES))
CXX_INTERNAL_HEADERS := $(filter %.$(CXX_INTERNAL_HEADER_EXTENSION),$(ALL_FILES))
BISONCXX_PARSERSPECS := $(filter %.$(BISONCXX_PARSERSPEC_EXTENSION),$(ALL_FILES))



###
$(CXX_PROGS): METHOD = Link       
$(SHAREDLIB_FILE): METHOD = Collect
# When a source file is deleted, the object files may linger. Let Make warn then.
#$(info ever generated: $(EVER_GENERATED_FILES))
# Action tells whether we're updating or creating.
$(CONVLIB_FILE): $(CXX_NONPROG_OBJECTS)
	$(QUIET) $(CXX) --shared $(LDFLAGS) -o $@ $^
# We don't archive object files member my member, because
$(CXX_OBJECTS): %.$(CXX_OBJECT_EXTENSION): %.$(CXX_SOURCE_EXTENSION)
	$(QUIET) rm -f $(CXX_PROGS) includes.txt
	@echo -n "Running $< ... "
# Don't create unless needed:

    #$(or $(filter metadata.txt,$(METADATA_TXT)),$(filter ../metadata.txt,$(METADATA_TXT)),$(error Will only create metadata.txt in current or parent directory, and nowhere else.))
	@echo "Change at least the set number and the authors."


	@echo
ifneq (,$(filter zip,$(MAKECMDGOALS)))
            $(info contains the set, you can still create the zip.)
            $(info Depending on whether we are in a set or an exercise directory, you can)
            $(info but it is in a subdir.)
    else
    endif



    .PHONY: metadatatxt_check build_check ordertxt_check
    ORDER_TXTS = $(patsubst %,%/order.txt,$(DIRECT_SUBDIRS))


%\:program: TEMPLATE = $(CXX_PROGRAM_TEMPLATE)

#define def_$(UUID)_$(HID)_$(CXX_HEADER_EXTENSION)
# Internal header template.

define CXX_PROGRAM_TEMPLATE
};
    try

        std::rethrow_exception(excp);
}

//%%implementation-header = "filename"
//%%s start-conditions
.|\\n   return 0x100;
// %%class-name: defining the name of the parser class
// %%filenames: specifying a generic filename

nonterminal:
Set: Set 0
$(foreach FILE,$(patsubst /%,%,$(patsubst $(@D)/%,%,$(call rwildcard,$(@D)/,*))),-$(FILE)$(NEWLINE))
TEMPLATES = $(filter %_TEMPLATE,$(.VARIABLES))
    %.$(CXX_SOURCE_EXTENSION): TEMPLATE = $(CXX_SOURCE_TEMPLATE)
    $(TEMPLATABLE_GOALS):
    # But it cannot be told to include such dependencies only for sources that
    NEED_DEP_INCLUDES := $(or $(MAKECMDGOALS_IS_EMPTY),$(GOALS_THAT_NEED_DEPS))

    $(CXX_PCH_DEPS): CXXFLAGS += -x c++-header

    # specification file is hard. So we simply keep a touchfile and rerun
	$(QUIET) mkdir -p $(dir $@)
	$(QUIET) $(BISONCXX) $(BISONCXXFLAGS) $< 
    # any other recipes.
    mostlyclean: depclean
### Some measures to help Parallel Make ( make --jobs n) ###
# With Parallel Make this more often turns out to be a problem. FixMe: why?
#$(foreach DIR,$(DIRECTORIES_FOUND), $(info $(PATH_STRAIGHTENING_RECIPE)))
.SECONDEXPANSION:
	$(ECHO_ACTION)
endif
