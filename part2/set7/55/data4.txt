# Detect the OS using uname

It assumes a GNU C++ compiler, and GNU Make:


  determine their include dependencies.
header file will cause all source files that (indirectly) include it to be
The Makefile accepts the usual variables (CXX, CXXFLAGS, CPPFLAGS,

DEPDIR (defaults to: $(DEPDIR)) can also be set but is best left alone.
Note that without analyzing dependencies, Make will not know which
    make mc/myclass.hh
The command for creating a program source differs because it shares its
## Making submission zip files.


# work to distinguish C++ from C.
# The file hooks.mk will be included if it exists.
CXX_SOURCE_EXTENSION ?= $(call first_extension_found, cc cpp C)
BISONCXX_PARSERSPEC_EXTENSION ?= $(call first_extension_found, bc++ bcpp bcxx bisonc++ bisoncpp bisoncxx )
# We use precompiled headers by default. But they can be turned off.
# The name of our convenience library.


# Use any of these words to indicate true or false.
define NEWLINE
USE_PRECOMPILED_HEADERS := $(call boolalpha,$(PCH))

# Reverses a word list, to list deepest directories first after sort.

MAIN_REGEX := int[[:space:]]+main[[:space:]]*\(
# Sources that aren't program sources, are non-program sources.

.SUFFIXES:
	$(QUIET) $(CXX) $(CPPFLAGS) $(CXXFLAGS) -c -o $@ $<
# Rules for creating C++ object files.

$(CXX_PROGS): $(CONVLIB_FILE)
$(CONVLIB_FILE): METHOD = Collect
# When compiling a precompiled header, specify that it's a header.
    $(warning $(NEWLINE)Warning: Make may once have generated, but cannot update any more the following files:$(NEWLINE)$(NEWLINE)  $(UNKNOWN_GENERATED_FILES)$(NEWLINE)$(NEWLINE)Perhaps their sources do not exist any more. Consider cleaning them up.)

# In the recipe of the rule,
# $@ is the target, i.e. $(CONVLIB_FILE)
# If any program object file is newer than the program itself,

clean: mostlyclean
# Even if a file 'clean' exists, 'make clean' keeps working.
.SECONDARY: $(CXX_PRECOMPILED_HEADERS) $(CXX_OBJECTS)

    # Only create metadata.txt here or in parent.
	@echo
	@echo "If it is the second, specify the initials of whoever rated the first attempt."
	$(QUIET) printf '$(subst $(NEWLINE),\n,$(TEMPLATE))' >> $(@)
	@echo "Please edit it, because an auto-generated one is almost certainly wrong."

        ifeq (../metadata.txt,$(wildcard ../metadata.txt))
            $(error No metadata.txt in current dir. Perhaps we are not in a set directory.)
        # One metadata.txt found.
            $(error Metadata.txt in unexpected directory.)
        else

    $(error Other than exercise dirs present. (Perhaps we are not in a set dir.))
    $(ZIPFILE): metadatatxt_check build_check ordertxt_check
    # Every subdir must have an order.txt.
	@if grep -q "John Doe" metadata.txt || grep -q 'Set 0' metadata.txt ; then echo "metadata.txt still contains bogus info." ; false ; fi
# Give Make no way to make hooks.mk. User has to create it.

	$(QUIET) if test -e "$(ACTUAL_FILE)" ; then echo "$(ACTUAL_FILE) already exists." ; false ; fi
#exist yet, can be created. Use like: make bar.hh
endef
define CXX_INTERNAL_HEADER_TEMPLATE
endef


    {
    try
    {
# Scanner (tokenizer) specification template.
//%%class-header = "filename"
//%%no-lines
%%%%
define BISONCXX_PARSERSPEC_TEMPLATE
//  Flexc++-generated default. Adjust to needs.
// %%parsefun-source: defining the parse() function sourcefile

define METADATA_TXT_TEMPLATE

# Giving Make a recipe to create any file 'foo.cc' from thin air is dangerous,
TEMPLATABLE_EXTENSIONS = $(foreach TTYPE,$(TEMPLATE_TYPES),$($(TTYPE)_EXTENSION))
    %.$(CXX_HEADER_EXTENSION): UUID := $(subst -,_,$(shell $(UUIDGEN)))

    # actually must be compiled. So we simply always include all dependencies.
    TARGETS_THAT_DONT_NEED_DEPS := clean mostlyclean depclean help $(TEMPLATABLE_GOALS) $(ZIPFILE) $(ORDER_TXTS) $(ORDER_TXT) $(METADATA_TXT)
    endif
    $(CXX_SOURCE_DEPS): CPPFLAGS += -E -fdirectives-only -MQ $(patsubst %.$(CXX_SOURCE_EXTENSION),%.$(CXX_OBJECT_EXTENSION),$<) -MM -MF $@
    #-MF Specify file to write dependencies to.
    # Predicting which files flexc++ will generate from a given scanner
	$(QUIET) touch $@
    # Note that both bisonc++ and flexc++ are run merely to update the empty
    # Keep deps once we have them.


# To mitigate, we tell Make how to remove the /../ from paths:
DIRECTORIES_FOUND = $(sort $(filter-out ./,$(dir $(ALL_FILES:./%=%))))
# To work without precompiled headers:
	$(QUIET) test -f $@ || echo "WARNING: $@ not created despite trying. Might want to increase resources or resort to PCH=no."
# Inclusion is transitive, but we only record direct includes. 
